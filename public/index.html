<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Central Santua | Red Oficial de Hallazgos</title>
    <link rel="stylesheet" href="style.css">

    <script src="https://unpkg.com/html5-qrcode"></script>
</head>
<body>

<header class="navbar"> <nav class="container-nav-ajustado">
        <a href="index.html" class="logo-link">
            <h1 class="logo">CENTRAL<span>SANTUA</span></h1>
        </a>

        <div class="nav-acciones">
            <div id="auth-buttons">
                <a href="login.html" class="btn-auth login">Ingresar</a>
                <a href="registro.html" class="btn-auth registro">Registrarse</a>
            </div>

            <button id="boton-menu-privado" class="boton-menu" onclick="toggleMenu()" style="display: none;" aria-label="Abrir men√∫">
                <span class="barrita"></span>
                <span class="barrita"></span>
                <span class="barrita"></span>
            </button>
        </div>
    </nav>
</header>

<div id="side-menu" class="menu-lateral">
    <a href="javascript:void(0)" class="cerrar-btn" onclick="toggleMenu()">&times;</a>
    <a href="index.html">Inicio</a>
    <a href="encontre.html">Encontre algo</a>
    <a href="perdi.html">Perdi algo</a>
    <a href="perfil.html">Administrar Codigos QR</a>
    <a href="tutorial.html">¬øC√≥mo funciona?</a>
    <a href="ayuda.html">Ayuda</a>
    <a href="javascript:void(0)" onclick="abrirModalTerminos(event)">T√©rminos y Condiciones</a>
    <a href="javascript:void(0)" onclick="cerrarSesion()" style="color: #ff4d4d; font-weight: bold;">Cerrar Sesi√≥n</a>
</div>

<main class="container">
    <section class="hero-section">
        <h2>Tu tranquilidad, a un escaneo de distancia</h2>
        <p>La red directa para la recuperaci√≥n de documentos y patentes. Gesti√≥n segura, privada y en pocos segundos.</p>
    </section>
        
        <div class="stats-container">
    <div class="stat-box">
        <span class="stat-number" id="count-hallazgos">0</span>
        <span class="stat-label">Stock Hallazgos</span>
        <div class="tooltip-container">
            <span class="help-tooltip">?</span>
            <span class="tooltip-text">Objetos encontrados que esperan a su due√±o.</span>
        </div>
    </div>

    <div class="stat-divider"></div>

    <div class="stat-box">
        <span class="stat-number" id="count-busquedas">0</span>
        <span class="stat-label">Alertas Activas</span>
        <div class="tooltip-container">
            <span class="help-tooltip">?</span>
            <span class="tooltip-text">Personas que reportaron una p√©rdida recientemente.</span>
        </div>
    </div>
</div>
<div class="button-group">
    <button class="btn btn-activar-negro" onclick="verificarAccesoActivacion()" style="grid-column: 1 / -1; margin-bottom: 10px;">
    <span class="icon">‚ú®</span>
    <div class="btn-content">
        <span class="text">ACTIVAR STICKER QR</span>
    </div>
    <span class="icon">‚ú®</span>
</button>

    <a href="encontre.html" class="btn btn-encontre">
        <span class="icon">üîç</span>
        <div class="btn-content">
            <span class="text">ENCONTR√â ALGO</span>
        </div>
    </a>

    <a href="perdi.html" class="btn btn-perdi">
        <span class="icon">üõ°Ô∏è</span>
        <div class="btn-content">
            <span class="text">PERD√ç ALGO</span>
        </div>
    </a>
</div>
                <button class="btn-info-main" onclick="abrirGuia()">
            <span class="icon">üí°</span> LEER: ¬øC√ìMO FUNCIONA EL SISTEMA?
        </button>

        <section class="extra-info">
            <div class="info-card">
                <h3>Base Activa 24/7</h3>
                <p>Nuestra base de datos no descansa. Si hoy no hay coincidencia, el sistema sigue rastreando tu objeto hasta encontrarlo.</p>
            </div>
            <div class="info-card">
                <h3>Protocolo Seguro</h3>
                <p>Validamos cada entrega mediante un sistema de preguntas de seguridad para garantizar que el objeto vuelva a su due√±o leg√≠timo.</p>
            </div>
            <div class="info-card">
                <h3>Sin Intermediarios</h3>
                <p>Facilitamos el nexo directo a trav√©s de nuestra central de WhatsApp una vez que el "Match" es confirmado.</p>
            </div>
        </section>
    </main>

    <div id="modal-guia" class="modal-guia-overlay">
        <div class="modal-guia-content">
            <button class="cerrar-modal" onclick="cerrarGuia()">√ó</button>
            
            <div class="modal-header">
                <h2>Gu√≠a Operativa Central Santua</h2>
                <p>Entend√© c√≥mo protegemos y recuperamos tus pertenencias</p>
            </div>

            <div class="guia-pasos">
                
                <div class="paso-box especial">
                    <span class="nro">‚ö°</span>
                    <div class="txt">
                        <h4>Sistema de Memoria Activa</h4>
                        <p>Esta es nuestra mayor ventaja: **Nada se pierde**. Si report√°s algo que perdiste y a√∫n no fue encontrado, tu dato queda en "Guardia Permanente". En el instante en que alguien lo reporte, el sistema los vincula autom√°ticamente. **No necesit√°s buscar todos los d√≠as, nosotros lo hacemos por vos.**</p>
                    </div>
                </div>

                <div class="paso-box">
                    <span class="nro">1</span>
                    <div class="txt">
                        <h4>Carga de Datos Estandarizada</h4>
                        <p>Para evitar errores de lectura, el sistema solo acepta formatos limpios. Ingres√° DNI, Patentes o C√©dulas **SIN PUNTOS, GUIONES NI ESPACIOS**. Esto permite que el algoritmo compare millones de datos en milisegundos.</p>
                    </div>
                </div>

                <div class="paso-box">
                    <span class="nro">2</span>
                    <div class="txt">
                        <h4>Detecci√≥n de Coincidencias (Match)</h4>
                        <p>Cuando un n√∫mero de documento reportado como "Perdido" coincide con uno reportado como "Encontrado", el sistema genera un **Match de Seguridad**. Solo en ese momento se habilitan los canales de contacto.</p>
                    </div>
                </div>

                <div class="paso-box">
                    <span class="nro">3</span>
                    <div class="txt">
                        <h4>Contacto v√≠a Central de WhatsApp</h4>
                        <p>Si hay coincidencia, aparecer√° un bot√≥n directo a nuestra central. All√≠, un operador gestionar√° el nexo para la devoluci√≥n. Nunca publicamos tus datos personales ni tu tel√©fono en la web.</p>
                    </div>
                </div>

                <div class="paso-box">
                    <span class="nro">4</span>
                    <div class="txt">
                        <h4>Validaci√≥n Sin Exponer Tu Privacidad</h4>
                        <p>Entendemos tu seguridad. En lugar de pedirte fotos de documentos, realizamos un **Cotejo de Informaci√≥n Privada**. Te haremos preguntas sobre datos que figuran en el objeto (como una direcci√≥n, un segundo nombre o un detalle espec√≠fico) para verificar que sos el due√±o real sin invadir tu privacidad digital.</p>
                    </div>
                </div>

                <div class="paso-box">
                    <span class="nro">5</span>
                    <div class="txt">
                        <h4>Compromiso de Devoluci√≥n</h4>
                        <p>Central Santua es una comunidad. Si encontraste algo, tu reporte es la √∫nica esperanza de alguien para recuperar su documentaci√≥n. Fomentamos la honestidad y la rapidez en cada entrega.</p>
                    </div>
                </div>
            </div>

            <button class="btn-cerrar-final" onclick="cerrarGuia()">ENTENDIDO, VOLVER AL INICIO</button>
        </div>
    </div>

    <div id="modal-terminos" class="modal-guia-overlay" style="display: none;">
    <div class="modal-guia-content">
        <button class="cerrar-modal" onclick="cerrarModalTerminos()">√ó</button>
        <h2 style="color: #4facfe;">T√©rminos y Condiciones</h2>
        <p style="color: #ccc; margin-top: 20px;"><p><strong>1. Rol de la Plataforma:</strong> Central Santua act√∫a √∫nicamente como un nexo digital entre hallazgos y b√∫squedas. No somos responsables por el estado de los objetos ni por las acciones de terceros.</p>
            
            <p><strong>2. Veracidad de Datos:</strong> El usuario garantiza que la informaci√≥n proporcionada es veraz. El uso de datos falsos o reportes malintencionados resultar√° en el bloqueo permanente de acceso.</p>
            
            <p><strong>3. Privacidad y Seguridad:</strong> Los n√∫meros de documento y patentes se procesan solo para detectar coincidencias (Match). Tu WhatsApp no se hace p√∫blico; solo se utiliza para gestionar la devoluci√≥n una vez confirmado el Match.</p>
            
            <p><strong>4. Devoluci√≥n Segura:</strong> Recomendamos realizar las entregas en lugares p√∫blicos (comisar√≠as, estaciones, plazas). Central Santua no participa en el intercambio f√≠sico del objeto.</p>
            
            <p><strong>5. Compromiso Social:</strong> Al usar este sistema, te compromet√©s a actuar de buena fe para que los documentos vuelvan a sus due√±os leg√≠timos sin condiciones econ√≥micas previas.</p></p>
        <button class="btn-cerrar-final" onclick="cerrarModalTerminos()">ENTENDIDO</button>
    </div>
</div>

    <footer>
        <p>&copy; 2026 Central Santua - Gesti√≥n de Hallazgos con Responsabilidad Social</p>
    </footer>

    <script>
        function abrirGuia() {
            document.getElementById('modal-guia').style.display = 'flex';
            document.body.style.overflow = 'hidden'; // Evita scroll atr√°s
        }

        function cerrarGuia() {
            document.getElementById('modal-guia').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        window.onclick = function(event) {
            let modal = document.getElementById('modal-guia');
            if (event.target == modal) {
                cerrarGuia();
            }
        }
    </script>

  <script>
function gestionarInterfaz() {
    const logueado = localStorage.getItem('estaLogueado');
    const authContainer = document.getElementById('auth-buttons');
    const botonMenuPrivado = document.getElementById('boton-menu-privado');

    if (logueado === 'true') {
        // 1. Ocultamos los botones de auth
        if (authContainer) {
            authContainer.style.setProperty('display', 'none', 'important');
        }

        // 2. Forzamos la aparici√≥n del bot√≥n de las 3 rayas
        if (botonMenuPrivado) {
            botonMenuPrivado.style.setProperty('display', 'flex', 'important');
            botonMenuPrivado.style.visibility = 'visible';
            botonMenuPrivado.style.opacity = '1';
            
            // Esto asegura que las barritas internas sean blancas y visibles
            const barritas = botonMenuPrivado.querySelectorAll('.barrita');
            barritas.forEach(b => {
                b.style.backgroundColor = 'white';
                b.style.display = 'block';
            });
        }
    } else {
        if (authContainer) {
            authContainer.style.setProperty('display', 'flex', 'important');
        }
        if (botonMenuPrivado) {
            botonMenuPrivado.style.setProperty('display', 'none', 'important');
        }
    }
}

// Ejecuci√≥n inmediata y al cargar el DOM
gestionarInterfaz();
document.addEventListener('DOMContentLoaded', gestionarInterfaz);

// Funci√≥n para el men√∫ lateral
function toggleMenu() {
    const menu = document.getElementById("side-menu");
    if (menu) {
        if (menu.style.width === "250px") {
            menu.style.width = "0";
        } else {
            menu.style.width = "250px";
        }
    }
}

function cerrarSesion() {
    localStorage.clear();
    window.location.href = 'index.html';
}

let html5QrCode; // Variable global para el control de la c√°mara

function verificarAccesoActivacion() {
    // Verificamos si el usuario est√° logueado con tu variable actual
    const logueado = localStorage.getItem('estaLogueado');

    if (logueado !== 'true') {
        alert("¬°Hola! Para activar tu sticker y proteger tus objetos, primero deb√©s iniciar sesi√≥n.");
        window.location.href = "login.html";
        return;
    }

    // Si est√° logueado, abrimos la interfaz del esc√°ner
    abrirInterfazCamara();
}

function abrirInterfazCamara() {
    // Mostramos el contenedor negro que ya creaste
    document.getElementById('scanner-wrapper').style.display = 'flex';
    
    html5QrCode = new Html5Qrcode("reader");
    
    const config = { 
        fps: 10, 
        qrbox: { width: 250, height: 250 },
        aspectRatio: 1.0 
    };

    // Iniciamos la c√°mara trasera
    html5QrCode.start(
        { facingMode: "environment" }, 
        config,
        (decodedText) => {
            // √âXITO: Detect√≥ el QR
            detenerEscaneo();
            
            // Guardamos el c√≥digo para la p√°gina de pago
            localStorage.setItem("qr_escaneado_pendiente", decodedText);
            
            // Redirigimos a la p√°gina de informaci√≥n y pago
            window.location.href = "presentacion_pago.html";
        }
    ).catch(err => {
        // En lugar de un alert seco, damos instrucciones
        console.error("Error de c√°mara:", err);
        alert("¬°Ups! Para escanear el sticker necesitamos permiso para usar la c√°mara.\n\n" + 
              "Si no te apareci√≥ el cartel, busc√° el √≠cono de la 'C√°mara' o un 'Candado' en la barra de direcciones (arriba) y dale a 'Permitir'.");
        detenerEscaneo();
    });
}

function detenerEscaneo() {
    if (html5QrCode) {
        html5QrCode.stop().then(() => {
            document.getElementById('scanner-wrapper').style.display = 'none';
        }).catch(() => {
            document.getElementById('scanner-wrapper').style.display = 'none';
        });
    } else {
        document.getElementById('scanner-wrapper').style.display = 'none';
    }
}

</script>

<div id="scanner-wrapper" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 9999; flex-direction: column; align-items: center; justify-content: center;">
    <div style="background: #111; padding: 20px; border-radius: 15px; border: 2px solid #4facfe; width: 90%; max-width: 450px; text-align: center;">
        <h2 style="color: white; margin-bottom: 20px;">Escane√° tu Sticker QR</h2>
        <div id="reader" style="width: 100%; border-radius: 10px; overflow: hidden; background: black;"></div>
        <button onclick="detenerEscaneo()" style="margin-top: 25px; background: #ff4d4d; color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-weight: bold;">
            CANCELAR
        </button>
    </div>
</div>

    <script src="interfaz.js"></script>
</body>
</html>